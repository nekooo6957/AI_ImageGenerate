# AI_for_UrbanDesign å¹³å°ä¼˜åŒ–æ–¹æ¡ˆ

## é¡¹ç›®æ¦‚è¿°

ä¸º "Nano Banana Pro" AI åŸå¸‚è®¾è®¡ç”Ÿå›¾å¹³å°è¿›è¡Œå…¨é¢å‡çº§ï¼Œåœ¨ä¿ç•™ç°æœ‰æ‰€æœ‰åŠŸèƒ½çš„åŸºç¡€ä¸Šï¼Œæ–°å¢ç»“æ„åŒ–æ ‡ç­¾ã€é£æ ¼å‚è€ƒå›¾ä¸Šä¼ ã€å±€éƒ¨é‡ç»˜åŠŸèƒ½ã€å®Œå–„ç”¨æˆ·ç³»ç»Ÿå’Œæœ¬åœ°æ•°æ®æŒä¹…åŒ–ã€‚

---

## ä¸€ã€æŠ€æœ¯æ¶æ„é€‰å‹

### 1.1 æ–¹æ¡ˆå¯¹æ¯”

| ç»´åº¦ | å•æ–‡ä»¶HTML (ç°çŠ¶) | Vue 3 + Vite | Next.js (é™æ€å¯¼å‡º) |
|------|------------------|-------------|------------------|
| å¼€å‘æˆæœ¬ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ |
| ç»´æŠ¤æ€§ | â­ | â­â­â­â­ | â­â­â­â­â­ |
| æ€§èƒ½ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| éƒ¨ç½²å¤æ‚åº¦ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ |
| ç”Ÿæ€æ”¯æŒ | â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| å­¦ä¹ æ›²çº¿ | â­â­â­â­â­ | â­â­â­ | â­â­ |

**Next.js é€‚ç”¨æ€§åˆ†æï¼š**

ç”±äºä½ **æ²¡æœ‰æœåŠ¡å™¨**ï¼Œæ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°ï¼ŒNext.js çš„ä¼˜åŠ¿ï¼ˆSSRã€API Routesã€æœåŠ¡ç«¯æ¸²æŸ“ï¼‰æ— æ³•å……åˆ†å‘æŒ¥ã€‚

ä½† Next.js ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œé‡‡ç”¨**é™æ€å¯¼å‡º (Static Export)** æ¨¡å¼ï¼š

```bash
# next.config.js
output: 'export'  # é™æ€HTMLå¯¼å‡º
```

**Next.js é™æ€å¯¼å‡ºçš„ä¼˜åŠ¿ï¼š**
- React ç”Ÿæ€æœ€ä¸°å¯Œ
- TypeScript æ”¯æŒå®Œå–„
- App Router æ–‡ä»¶è·¯ç”±æ¸…æ™°
- æœªæ¥å¯æ— ç¼è¿ç§»åˆ°å…¨æ ˆæ¨¡å¼

**Next.js é™æ€å¯¼å‡ºçš„åŠ£åŠ¿ï¼š**
- é…ç½®ç›¸å¯¹å¤æ‚
- æ„å»ºæ—¶é—´è¾ƒé•¿
- å¯¹äºçº¯å‰ç«¯åº”ç”¨ï¼Œæœ‰ç‚¹"æ€é¸¡ç”¨ç‰›åˆ€"

**æœ€ç»ˆæ¨è: Next.js + Static Export**

æ—¢ç„¶ä½ å€¾å‘ä½¿ç”¨ Next.jsï¼Œæˆ‘ä»¬å°†é‡‡ç”¨è¿™ä¸ªæ–¹æ¡ˆï¼Œä½¿ç”¨é™æ€å¯¼å‡ºæ¨¡å¼éƒ¨ç½²ã€‚

### 1.2 æŠ€æœ¯æ ˆ

```yaml
æ ¸å¿ƒæ¡†æ¶:
  - Next.js 15 (App Router + Static Export)
  - React 19 (Server Components)
  - TypeScript 5.0+
  - Zustand (è½»é‡çŠ¶æ€ç®¡ç†ï¼Œæ›¿ä»£Redux)

UI/æ ·å¼:
  - Tailwind CSS 3.4+ (ä¿æŒä¸€è‡´æ€§)
  - shadcn/ui (é«˜è´¨é‡Reactç»„ä»¶åº“)
  - Framer Motion (ReactåŠ¨æ•ˆåº“)
  - Radix UI (æ— æ ·å¼å¯è®¿é—®ç»„ä»¶)

Canvas/ç»˜å›¾:
  - Fabric.js 6.0+ (å±€éƒ¨é‡ç»˜æ ¸å¿ƒåº“)
  - react-fabric-js (Reactå°è£…)

æ•°æ®æŒä¹…åŒ–:
  - IndexedDB (é€šè¿‡ Dexie.js 3.x å°è£…)
  - CryptoJS (å¯†ç /å¯†é’¥åŠ å¯†)
  - browser-image-compression (å›¾ç‰‡å‹ç¼©)

HTTPå®¢æˆ·ç«¯:
  - Axios (è¯·æ±‚æ‹¦æˆªå™¨)
```

---

## äºŒã€å­˜å‚¨æ–¹æ¡ˆè®¾è®¡

### 2.1 å¤šå±‚å­˜å‚¨æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IndexedDB (ä¸»å­˜å‚¨)                              â”‚
â”‚  - ç”¨æˆ·é¡¹ç›®æ•°æ®                                   â”‚
â”‚  - å†å²è®°å½•                                       â”‚
â”‚  - å›¾ç‰‡(Blob, WebPå‹ç¼©)                          â”‚
â”‚  - é‡ç»˜è’™ç‰ˆ                                       â”‚
â”‚  å®¹é‡: æ•°ç™¾MB ~ GBçº§                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  localStorage (é…ç½®)                              â”‚
â”‚  - UI ä¸»é¢˜é…ç½®                                    â”‚
â”‚  - API å¯†é’¥(åŠ å¯†)                                 â”‚
â”‚  - ç”¨æˆ·ä¼šè¯Token (7å¤©æœ‰æ•ˆæœŸ)                      â”‚
â”‚  å®¹é‡: ~5MB                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 IndexedDB æ•°æ®åº“ç»“æ„

```typescript
// æ•°æ®åº“: NanoBananaDB

Table: projects
  - id (è‡ªå¢)
  - name (é¡¹ç›®åç§°)
  - userId (ç”¨æˆ·ID)
  - createdAt, updatedAt

Table: generations
  - id (è‡ªå¢)
  - projectId (å…³è”é¡¹ç›®)
  - userId (ç”¨æˆ·ID)
  - prompt (æç¤ºè¯)
  - tags (åœºæ™¯æ ‡ç­¾ã€æ¯”ä¾‹ã€è´¨é‡)
  - status (pending/generating/completed/failed)
  - resultImages[] (ç”Ÿæˆç»“æœ)
  - referenceImages[] (å‚è€ƒå›¾ID)
  - styleReferenceImages[] (é£æ ¼å‚è€ƒå›¾ID)
  - createdAt, completedAt

Table: images
  - id (è‡ªå¢)
  - blob (å›¾ç‰‡æ•°æ®)
  - type (reference/result/mask/style-reference)
  - format (webp/png/jpeg)
  - width, height, compressedSize

Table: inpainting_sessions
  - id (è‡ªå¢)
  - generationId (å…³è”ç”Ÿæˆè®°å½•)
  - baseImageId (åº•å›¾ID)
  - masks[] (è’™ç‰ˆæ•°æ®)
  - toolStates[] (å·¥å…·çŠ¶æ€)

Table: users
  - id (è´¦å·)
  - passwordHash (SHA256åŠ å¯†)
  - sessionToken
  - lastLoginAt
  - preferences (ä¸»é¢˜ã€é»˜è®¤æ ‡ç­¾ç­‰)
```

### 2.3 å›¾ç‰‡ä¼˜åŒ–ç­–ç•¥

- è½¬æ¢ä¸º WebP æ ¼å¼
- æœ€å¤§è¾¹é•¿ 1920px
- å‹ç¼©è´¨é‡ 0.8
- å•æ–‡ä»¶ä¸Šé™ 2MB

---

## ä¸‰ã€åŠŸèƒ½æ¨¡å—è®¾è®¡

### 3.1 ä¿ç•™ç°æœ‰åŠŸèƒ½

âœ… ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
âœ… é¡¹ç›®ç®¡ç†ï¼ˆåˆ›å»º/åˆ é™¤/é‡å‘½å/åˆ‡æ¢ï¼‰
âœ… AI å›¾åƒç”Ÿæˆï¼ˆAPIMart APIï¼‰
âœ… æç¤ºè¯ä¼˜åŒ–
âœ… å›¾ç‰‡é¢„è§ˆ Modalï¼ˆç¼©æ”¾ã€å¹³ç§»ã€ä¸‹è½½ï¼‰
âœ… å‚æ•°é…ç½®ï¼ˆæ¯”ä¾‹ã€ç²¾åº¦ã€æ•°é‡ï¼‰
âœ… ç”Ÿæˆå†å²è®°å½•
âœ… èšå…‰ç¯è·ŸéšåŠ¨æ•ˆ

### 3.2 æ–°å¢åŠŸèƒ½

#### åŠŸèƒ½1: ç»“æ„åŒ–æ ‡ç­¾é€‰æ‹©

```
åº”ç”¨åœºæ™¯:
  - åŸå¸‚è§„åˆ’è®¾è®¡
  - å»ºç­‘è®¾è®¡
  - æ™¯è§‚è®¾è®¡
  - æ¦‚å¿µåœºæ™¯å›¾

ç”»é¢æ¯”ä¾‹: 1:1, 3:2, 2:3, 4:3, 3:4, 16:9, 9:16, 21:9, 4:5, 5:4

ç”»é¢è´¨é‡: 1K, 2K, 4K
```

#### åŠŸèƒ½2: é£æ ¼å‚è€ƒå›¾ç‰‡ä¸Šä¼ 

- å…è®¸ç”¨æˆ·ä¸Šä¼ é£æ ¼å‚è€ƒå›¾ï¼Œå½±å“ç”Ÿæˆå›¾ç‰‡çš„é£æ ¼
- ä½œä¸º `styleReferenceImages[]` å­˜å‚¨åœ¨ IndexedDB
- APIè°ƒç”¨æ—¶ä¸æ ‡æ³¨å›¾ä¸€èµ·ä½œä¸ºå‚è€ƒå›¾ä¼ å…¥

#### åŠŸèƒ½3: å›¾ç‰‡æ ‡æ³¨åŠŸèƒ½

**åŠŸèƒ½è¯´æ˜ï¼š**
ç”¨æˆ·å¯ä»¥åœ¨ä¸Šä¼ çš„å›¾ç‰‡ä¸Šè¿›è¡Œæ ‡æ³¨ï¼ˆåœˆé€‰é‡ç‚¹ã€æ·»åŠ æ–‡å­—è¯´æ˜ç­‰ï¼‰ï¼Œæ ‡æ³¨åçš„å›¾ç‰‡è‡ªåŠ¨æ›´æ–°ï¼Œä½œä¸ºå‚è€ƒå›¾ç”¨äºç”Ÿæˆæ–°å›¾ã€‚

**å·¥å…·åˆ—è¡¨:**
| å·¥å…· | è¯´æ˜ |
|------|------|
| ç”»ç¬” | è‡ªç”±ç»˜åˆ¶ï¼Œåœˆé€‰é‡ç‚¹åŒºåŸŸ |
| å¤šè¾¹å½¢å¥—ç´¢ | ç²¾ç¡®é€‰æ‹©å¤šè¾¹å½¢åŒºåŸŸ |
| é­”æ£’ | åŸºäºé¢œè‰²ç›¸ä¼¼åº¦é€‰æ‹©ï¼ˆå¯è°ƒå®¹å·®ï¼‰ |
| æ–‡å­—æ ‡è®° | åœ¨å›¾ç‰‡ä¸Šæ·»åŠ æ ‡æ³¨æ–‡å­— |

**åŠŸèƒ½ç‰¹æ€§:**
- æ’¤é”€/æ¢å¤ï¼ˆæœ€å¤š50æ­¥ï¼‰
- ç”»ç¬”/æ–‡å­—é¢œè‰²é€‰æ‹©å™¨
- ç¬”åˆ·å¤§å°è°ƒèŠ‚ï¼ˆ1-100pxï¼‰
- é­”æ£’å®¹å·®è°ƒèŠ‚ï¼ˆ0-100ï¼‰

**æŠ€æœ¯å®ç°:**
- ä½¿ç”¨ Fabric.js ä½œä¸ºCanvaså¼•æ“
- æ ‡æ³¨å®Œæˆåå¯¼å‡ºä¸º base64 å›¾ç‰‡
- APIè°ƒç”¨æ—¶å°†æ ‡æ³¨å›¾ä½œä¸ºå‚è€ƒå›¾ä¼ å…¥

**æµç¨‹:**
```
ä¸Šä¼ å›¾ç‰‡ â†’ æ ‡æ³¨ï¼ˆç”»ç¬”/å¥—ç´¢/é­”æ£’/æ–‡å­—ï¼‰â†’ å¯¼å‡ºæ ‡æ³¨å›¾
  â†“
ç”¨æˆ·è¾“å…¥æç¤ºè¯
  â†“
è°ƒç”¨ APIï¼ˆæ ‡æ³¨å›¾ä½œä¸ºå‚è€ƒå›¾ï¼‰â†’ ç”Ÿæˆæ–°å›¾
```

#### åŠŸèƒ½4: å®Œå–„ç”¨æˆ·ç³»ç»Ÿ

- å¯†ç SHA256åŠ å¯†å­˜å‚¨
- ä¼šè¯æŒä¹…åŒ–ï¼ˆ7å¤©æœ‰æ•ˆæœŸï¼‰
- TokenéªŒè¯æœºåˆ¶
- ç”¨æˆ·åå¥½è®¾ç½®

#### åŠŸèƒ½5: æœ¬åœ°æ•°æ®æŒä¹…åŒ–

- IndexedDBä¸»å­˜å‚¨ï¼ˆGBçº§å®¹é‡ï¼‰
- è‡ªåŠ¨æ¸…ç†30å¤©å‰çš„å›¾ç‰‡
- å­˜å‚¨å®¹é‡ç›‘æ§ï¼ˆ>80%è§¦å‘æ¸…ç†ï¼‰
- é¡¹ç›®å¯¼å‡º/å¯¼å…¥åŠŸèƒ½

---

## å››ã€UI/UX å¢å¼ºæ–¹æ¡ˆ

### 4.1 åŠ¨æ•ˆåˆ†å±‚è®¾è®¡

```
Level 1 - å¾®äº¤äº’:
  - CSS transition (æŒ‰é’®hoverã€è¾“å…¥æ¡†focus)
  - Framer Motion (ç»„ä»¶è¿›å…¥/ç¦»å¼€)

Level 2 - å¸ƒå±€åŠ¨ç”»:
  - Framer Motion Layout (åˆ—è¡¨é‡æ’)
  - AnimatePresence (å†å²å¡ç‰‡æ’å…¥)

Level 3 - å¤æ‚äº¤äº’:
  - Framer Motion (èšå…‰ç¯å¢å¼ºã€ç¼©æ”¾åŠ¨ç”»)
  - spring åŠ¨ç”» (æŒ‰å‹åé¦ˆ)
```

### 4.2 èšå…‰ç¯å¢å¼ºæ•ˆæœ

```typescript
// ä½¿ç”¨ Framer Motion å®ç°èšå…‰ç¯è·Ÿéš
import { motion, useMotionValue, useSpring } from 'framer-motion';

function SpotlightButton() {
  const x = useMotionValue(0);
  const y = useMotionValue(0);

  const handleMouseMove = (e: React.MouseEvent) => {
    const rect = e.currentTarget.getBoundingClientRect();
    x.set(e.clientX - rect.left);
    y.set(e.clientY - rect.top);
  };

  return (
    <motion.button
      onMouseMove={handleMouseMove}
      whileTap={{ scale: 0.97 }}
      style={{ '--x': x, '--y': y }}
    >
      <span className="spotlight-overlay" />
      Button Text
    </motion.button>
  );
}
```

### 4.3 æ ‡ç­¾é€‰æ‹©UIè®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨åœºæ™¯                        â”‚
â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”       â”‚
â”‚  â”‚ ğŸ™â”‚ â”‚ ğŸ›â”‚ â”‚ ğŸŒ³â”‚ â”‚ ğŸ’¡â”‚       â”‚
â”‚  â”‚åŸè§„â”‚ â”‚å»ºç­‘â”‚ â”‚æ™¯è§‚â”‚ â”‚æ¦‚å¿µâ”‚    â”‚
â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”»é¢æ¯”ä¾‹                        â”‚
â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” ...  â”‚
â”‚  â”‚1:1â”‚ â”‚3:2â”‚ â”‚2:3â”‚ â”‚4:3â”‚       â”‚
â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€å®ç°æ­¥éª¤

### Phase 1: åŸºç¡€é‡æ„ (2-3å‘¨)

```
Week 1:
  [ ] åˆå§‹åŒ– Next.js 15 + TypeScript é¡¹ç›®
  [ ] é…ç½® Tailwind CSS + shadcn/ui
  [ ] è®¾è®¡ Zustand store ç»“æ„
  [ ] å®ç° IndexedDB æ•°æ®å±‚ (Dexie.js)
  [ ] è¿ç§»ç”¨æˆ·è®¤è¯é€»è¾‘
  [ ] **ç ”ç©¶ APIMart API æ–‡æ¡£ï¼ˆé£æ ¼å‚è€ƒå›¾å‚æ•°ï¼‰**

Week 2:
  [ ] è¿ç§»é¡¹ç›®ç®¡ç†åŠŸèƒ½
  [ ] è¿ç§»å›¾ç‰‡ç”Ÿæˆæ ¸å¿ƒé€»è¾‘
  [ ] è¿ç§»å†å²è®°å½•åŠŸèƒ½
  [ ] å®ç°å›¾ç‰‡ä¼˜åŒ–å­˜å‚¨

Week 3:
  [ ] è¿ç§»UIç»„ä»¶ (ä½¿ç”¨ shadcn/ui)
  [ ] ä½¿ç”¨ Framer Motion å®ç°èšå…‰ç¯åŠ¨æ•ˆ
  [ ] æµ‹è¯•å®Œæ•´æµç¨‹
```

### Phase 2: æ–°å¢åŠŸèƒ½ (3-4å‘¨)

```
Week 4:
  [ ] ç»“æ„åŒ–æ ‡ç­¾é€‰æ‹©ç»„ä»¶
  [ ] é£æ ¼å‚è€ƒå›¾ä¸Šä¼ åŠŸèƒ½

Week 5-6:
  [ ] Fabric.js é›†æˆ
  [ ] ç”»ç¬”å·¥å…·å®ç°
  [ ] å¤šè¾¹å½¢å¥—ç´¢å·¥å…·
  [ ] æ’¤é”€/æ¢å¤ç³»ç»Ÿ

Week 7:
  [ ] é­”æ£’å·¥å…·(æ³›æ´ªå¡«å……ç®—æ³•)
  [ ] æ–‡å­—æ ‡è®°å·¥å…·
  [ ] é¢œè‰²é€‰æ‹©å™¨
  [ ] ç¬”åˆ·/å®¹å·®è°ƒèŠ‚

Week 8:
  [ ] å±€éƒ¨é‡ç»˜APIé›†æˆ
  [ ] é”™è¯¯å¤„ç†ä¸é‡è¯•
```

### Phase 3: ä¼˜åŒ–ä¸å‘å¸ƒ (1-2å‘¨)

```
Week 9:
  [ ] æ€§èƒ½ä¼˜åŒ–
  [ ] å­˜å‚¨å®¹é‡ç›‘æ§
  [ ] è‡ªåŠ¨æ¸…ç†ç­–ç•¥

Week 10:
  [ ] ç”¨æˆ·æ–‡æ¡£
  [ ] éƒ¨ç½²è„šæœ¬
  [ ] æµ‹è¯•ä¸å‘å¸ƒ
```

---

## å…­ã€å…³é”®æ–‡ä»¶

### ç°æœ‰æ–‡ä»¶
- `nanobananaproç”Ÿå›¾å¹³å° -ç”¨æˆ·ç³»ç»Ÿ.html`
  - åŸå§‹åŠŸèƒ½å®ç°å‚è€ƒ
  - APIè°ƒç”¨æ¨¡å¼ (è¡Œ 295-333)
  - èšå…‰ç¯åŠ¨æ•ˆ (è¡Œ 14-25, 375)
  - æ•°æ®ç»“æ„ (è¡Œ 131-132)

### éœ€æ–°å»ºçš„æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `app/page.tsx` | ä¸»é¡µé¢ |
| `app/layout.tsx` | æ ¹å¸ƒå±€ |
| `lib/db/index.ts` | IndexedDB æ•°æ®åº“å®šä¹‰ (Dexie.js) |
| `lib/stores/auth-store.ts` | ç”¨æˆ·è®¤è¯ä¸ä¼šè¯ç®¡ç† (Zustand) |
| `lib/stores/project-store.ts` | é¡¹ç›®ç®¡ç†çŠ¶æ€ |
| `lib/stores/generation-store.ts` | ç”Ÿæˆå‚æ•°ä¸æ ‡ç­¾ |
| `lib/stores/inpainting-store.ts` | å±€éƒ¨é‡ç»˜çŠ¶æ€ |
| `components/TagSelector.tsx` | ç»“æ„åŒ–æ ‡ç­¾é€‰æ‹©ç»„ä»¶ |
| `components/InpaintingCanvas.tsx` | å±€éƒ¨é‡ç»˜Canvasç»„ä»¶ |
| `components/StyleReferenceUpload.tsx` | é£æ ¼å‚è€ƒå›¾ä¸Šä¼  |
| `components/SpotlightButton.tsx` | èšå…‰ç¯åŠ¨æ•ˆæŒ‰é’® |
| `lib/utils/image-optimizer.ts` | å›¾ç‰‡å‹ç¼©ä¼˜åŒ– |
| `lib/utils/crypto.ts` | åŠ å¯†/å“ˆå¸Œå·¥å…· |
| `lib/api/inpainting-api.ts` | å±€éƒ¨é‡ç»˜APIå°è£… |
| `hooks/use-spotlight.ts` | èšå…‰ç¯æ•ˆæœHook |
| `hooks/use-indexeddb.ts` | IndexedDBæ“ä½œHook |

### Next.js é…ç½®æ–‡ä»¶

```javascript
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export',           // é™æ€å¯¼å‡º
  images: {
    unoptimized: true         // ç¦ç”¨å›¾ç‰‡ä¼˜åŒ–ï¼ˆé™æ€å¯¼å‡ºè¦æ±‚ï¼‰
  },
  trailingSlash: true,
  distDir: 'out'
};

module.exports = nextConfig;
```

---

## ä¸ƒã€API è°ƒç”¨æ–¹æ¡ˆ

### å›¾ç‰‡æ ‡æ³¨ + ç”Ÿå›¾æµç¨‹

```
ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡
  â†“
åœ¨ Canvas ä¸Šæ ‡æ³¨ï¼ˆç”»ç¬”/å¥—ç´¢/é­”æ£’/æ–‡å­—ï¼‰
  â†“
å¯¼å‡ºæ ‡æ³¨å›¾ï¼ˆbase64ï¼‰
  â†“
ç”¨æˆ·è¾“å…¥æç¤ºè¯
  â†“
è°ƒç”¨ APIMart API â†’ ç”Ÿæˆæ–°å›¾
```

### API è¯·æ±‚æ ¼å¼

```javascript
// æ ‡æ³¨å›¾ä½œä¸ºå‚è€ƒå›¾ï¼Œç”Ÿæˆæ–°å›¾
POST https://api.apimart.ai/v1/images/generations
Headers: {
  "Authorization": "Bearer YOUR_API_KEY",
  "Content-Type": "application/json"
}
Body: {
  model: "gemini-3-pro-image-preview",
  prompt: "ç°ä»£é£æ ¼çš„é«˜å±‚å»ºç­‘ï¼Œç»ç’ƒå¹•å¢™è®¾è®¡...",
  image_urls: [
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUg..."  // æ ‡æ³¨åçš„å›¾ç‰‡
  ],
  size: "1:1",
  resolution: "1K",
  n: 1
}
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `model` | æ¨¡å‹åç§° | `gemini-3-pro-image-preview` |
| `prompt` | æç¤ºè¯ | ç”¨æˆ·è¾“å…¥çš„æè¿° |
| `image_urls` | å‚è€ƒå›¾åˆ—è¡¨ | æ ‡æ³¨åçš„å›¾ç‰‡ base64 |
| `size` | ç”»é¢æ¯”ä¾‹ | `1:1`, `16:9`, `4:3` ç­‰ |
| `resolution` | åˆ†è¾¨ç‡ | `1K`, `2K`, `4K` |
| `n` | ç”Ÿæˆæ•°é‡ | å›ºå®šä¸º `1` |

### æ ‡æ³¨å›¾å¯¼å‡ºç¤ºä¾‹

```typescript
// å°† Canvas æ ‡æ³¨å¯¼å‡ºä¸º base64
function exportAnnotatedImage(canvas: HTMLCanvasElement): string {
  return canvas.toDataURL('image/png');
}
```

---

## å…«ã€é£é™©ä¸åº”å¯¹

| é£é™© | åº”å¯¹æªæ–½ |
|------|---------|
| IndexedDB å…¼å®¹æ€§ | æä¾›localStorageé™çº§æ–¹æ¡ˆ |
| å¤§å›¾ç‰‡å¯¼è‡´å´©æºƒ | è‡ªåŠ¨å‹ç¼© + åˆ†å—å­˜å‚¨ |
| APIé™æµ | ä½¿ç”¨é‡ç›‘æ§ + æœ¬åœ°ç¼“å­˜ |
| ç”¨æˆ·æ•°æ®ä¸¢å¤± | å®šæœŸè‡ªåŠ¨å¤‡ä»½ + å¯¼å‡ºåŠŸèƒ½ |
| é­”æ£’æ€§èƒ½é—®é¢˜ | Web Workerå¼‚æ­¥å¤„ç† |

---

## ä¹ã€éªŒè¯æ–¹å¼

### åŠŸèƒ½æµ‹è¯•
1. ç”¨æˆ·ç™»å½•ååˆ·æ–°é¡µé¢ï¼Œä¼šè¯ä¿æŒ7å¤©
2. ä¸Šä¼ 100å¼ å›¾ç‰‡ï¼ŒIndexedDBæ­£å¸¸å­˜å‚¨
3. å›¾ç‰‡æ ‡æ³¨å·¥å…·ï¼ˆç”»ç¬”/å¥—ç´¢/é­”æ£’/æ–‡å­—ï¼‰æ­£å¸¸å·¥ä½œ
4. æ’¤é”€/æ¢å¤æœ€å¤š50æ­¥
5. æ ‡æ³¨å›¾æ­£ç¡®å¯¼å‡ºå¹¶ä½œä¸ºå‚è€ƒå›¾ç”Ÿæˆæ–°å›¾

### æ€§èƒ½æµ‹è¯•
1. æ‰“åŒ…äº§ç‰© < 200KB (gzipped)
2. é¦–å±åŠ è½½ < 2s
3. å›¾ç‰‡å‹ç¼©ç‡ > 60%
4. Canvas 60fps æµç•…ç»˜åˆ¶

### å…¼å®¹æ€§æµ‹è¯•
- Chrome 120+, Firefox 120+, Safari 17+, Edge 120+
